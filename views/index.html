<!doctype html>
<html>
<head>
	<title>Calculate Body Fat</title>
	<script src="/scripts/jquery-1.9.1.js" type="text/javascript"></script>
	<script src="/scripts/moment.min.js" type="text/javascript"></script>
</head>
<body>
	<p>Calculate Body Fat:</p>
	<form id="body-fat-form">
		<label for="genderInput">Gender:</label>
		<input type="text" name="gender" id="genderInput" value="" />
		<br />
		<label for="ageInput">Age:</label>
		<input type="numeric" name="age" id="ageInput" value=""/> 
		<br />
		<label>Unit:</label>
		<br />
		<label for="metric">Metric</label>
		<input type="radio" name="unitSelect" id="metric" value="metric" checked="checked" />
		<label for="imperial">Imperial</label>
		<input type="radio" name="unitSelect" id="imperial" value="imperial" />
		<br />
		<label for="weightInput">Weight:</label>
		<input type="numeric" name="weight" id="weightInput" value="" />
		<br />
		<label for="chestInput">Chest:</label>
		<input type="numeric" name="chest" id="chestInput" value="" />
		<br />
		<label for="thighInput">Thigh:</label>
		<input type="numeric" name="thigh" id="thighInput" value="" />
		<br />
		<label for="absInput">Abs:</label>
		<input type="numeric" name="abs" id="absInput" value="" />
		<br />
	  	<input type="submit" value="Get Body Fat"/>
	</form>

	<button id="test">Test</button>

	<script type="text/javascript">

		//simple helper function to make an object out of our form
		$.fn.serializeObject = function()
		{
		   var o = {};
		   var a = this.serializeArray();
		   $.each(a, function() {
		       if (o[this.name]) {
		           if (!o[this.name].push) {
		               o[this.name] = [o[this.name]];
		           }
		           o[this.name].push(this.value || '');
		       } else {
		           o[this.name] = this.value || '';
		       }
		   });
		   return o;
		};

		$(function() {
			$('#body-fat-form').on('submit', function(e) {
				e.preventDefault();
				var formData = $(this).serializeObject();
				formData.date = moment(new Date()).format('YYYY-MM-DD');
				var serializedForm = JSON.stringify(formData);

				$.ajax({
					type: "POST",
					url: "/bodyfat/",
					data: serializedForm,
					contentType: "application/json; charset=utf-8",
					dataType: "json"
				}).done(function(data) {
					console.log(data);
				}).fail(function(error) {
					if(error.status !== 201) { //201 returns an error for some reason
						console.log('Error in retrieving body fat:\n');
						console.log(error);
					}
					else {
						console.log('Successfully added item');
					}
				});

				return false; //avoid execution of actual submission
			});
		});
	</script>
</body>
</html>